{# Load the tag library #}
{% load django_bootstrap5 %}

{# Load CSS and JavaScript #}
{% bootstrap_css %}
{% bootstrap_javascript %}

<!DOCTYPE html>
<html>
  <head>
    <title class="align-self-center">Plant Calendar</title>
    {% comment %} <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    /> {% endcomment %}
    <script
      src="https://unpkg.com/htmx.org@2.0.4"
      integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
      crossorigin="anonymous"
    ></script>
    {% comment %} <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script> {% endcomment %}
  </head>
  <body>
    <header>
      <h1><a href="/">Plant Calendar PoC</a></h1>
    </header>

    <main
      id="main-page"
      class="container"
    >
      <div hx-target="this" hx-swap="outerHTML">
        <button
          hx-get="{% url 'add_plant_record' %}"
          class="btn btn-primary btn-lg"
        >
          Add record &#43;
        </button>
      </div>

      <div class="mt-2">
        <button
          hx-trigger="click"
          hx-get="{% url 'add_plant' %}"
          hx-target="afterend"
          class="btn btn-primary btn-lg"
        >
          Add Plant &#43;
        </button>
      </div>
      <hr />
      <div class="row">
        <div class="col">
          <table class="table table-striped">
            <thead>
              <tr>
                <th class="px-2">Plant Name</th>
                <th class="px-2">Fertiliser</th>
                <th class="px-2">Sun Light Condition</th>
                <th class="px-2">Plant Date</th>
                <th class="px-2">Harvest Date</th>
                <th></th>
              </tr>
            </thead>

            <tbody
              hx-trigger="load, plantTableChanged from:body, plantRecordAdded from:body, plantRecordDeleted from:body"
              hx-get="{% url 'plant_table' %}"
              hx-target="this"
            >
              <tr>
                <td class="spinner-border" role="status">
                  <span class="visually-hidden">Loading...</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </body>

  <div id="modal" class="modal fade">
    <div id="dialog" class="modal-dialog" hx-target="this"></div>
  </div>

  <script>
    var modal = new bootstrap.Modal(document.getElementById("modal"));

    htmx.on("htmx:afterSwap", (e) => {
      // Response targeting #dialog => show the modal
      if (e.detail.target.id == "dialog") {
        modal.show();
      }
    });

    htmx.on("htmx:beforeSwap", (e) => {
      // Empty response targeting #dialog => hide the modal
      if (e.detail.target.id == "dialog" && !e.detail.xhr.response) {
        modal.hide();
        e.detail.shouldSwap = false;
      }
    });

    // Remove dialog content after hiding
    htmx.on("hidden.bs.modal", () => {
      document.getElementById("dialog").innerHTML = "";
    });
  </script>
</html>
